<mxGraphModel>
  <root>
    <mxCell id="0"/>
    <mxCell id="1" parent="0"/>
    
    <!-- Title -->
    <mxCell id="title" value="DA3 Serverless Request Flow" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="280" y="20" width="260" height="30" as="geometry"/>
    </mxCell>
    
    <!-- Step 1: Client Request -->
    <mxCell id="step1" value="Client Request&#xa;(HTTP POST)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=13;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="340" y="80" width="160" height="60" as="geometry"/>
    </mxCell>
    
    <!-- Step 2: Authentication -->
    <mxCell id="step2" value="Authentication&#xa;(API Key Validation)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4472C4;strokeColor=#1E5F96;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="340" y="170" width="160" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Step 3: Image Input -->
    <mxCell id="step3" value="Image Input&#xa;(URL or Base64)" style="rhombus;whiteSpace=wrap;html=1;fillColor=#FFC000;strokeColor=#B07800;fontSize=12;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="350" y="250" width="140" height="80" as="geometry"/>
    </mxCell>
    
    <!-- Step 4a: URL Path -->
    <mxCell id="step4a" value="HTTP GET&#xa;(Download Image)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#70AD47;strokeColor=#4A7322;fontColor=#ffffff;fontSize=11;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="200" y="360" width="120" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Step 4b: Base64 Path -->
    <mxCell id="step4b" value="Decode&#xa;(Base64 → Binary)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#70AD47;strokeColor=#4A7322;fontColor=#ffffff;fontSize=11;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="520" y="360" width="120" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Step 5: Image Processing -->
    <mxCell id="step5" value="Image Processing&#xa;(Format Detection &amp; RGB Conversion)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#5B9BD5;strokeColor=#2E558A;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="340" y="450" width="160" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Step 6: Validation -->
    <mxCell id="step6" value="Resolution Check&#xa;(Max 4096×4096)" style="rhombus;whiteSpace=wrap;html=1;fillColor=#FFC000;strokeColor=#B07800;fontSize=11;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="350" y="530" width="140" height="70" as="geometry"/>
    </mxCell>
    
    <!-- Step 7: Model Loading -->
    <mxCell id="step7" value="Model Loading&#xa;(DA3 from Cache)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4472C4;strokeColor=#1E5F96;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="340" y="630" width="160" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Step 8: GPU Inference -->
    <mxCell id="step8" value="GPU Inference&#xa;(PyTorch CUDA)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ED7D31;strokeColor=#A95C18;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="340" y="710" width="160" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Step 9: Output Processing -->
    <mxCell id="step9" value="Output Processing&#xa;(Normalize &amp; Encode to PNG)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#5B9BD5;strokeColor=#2E558A;fontColor=#ffffff;fontSize=11;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="340" y="790" width="160" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Step 10: Base64 Encoding -->
    <mxCell id="step10" value="Base64 Encoding&#xa;(PNG → Base64)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#70AD47;strokeColor=#4A7322;fontColor=#ffffff;fontSize=11;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="340" y="870" width="160" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Step 11: Response -->
    <mxCell id="step11" value="JSON Response&#xa;(Depth Stats + Image)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="340" y="950" width="160" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Error Handling -->
    <mxCell id="error" value="Error Response&#xa;(400/500 + Message)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C00000;strokeColor=#770000;fontColor=#ffffff;fontSize=11;fontStyle=1" vertex="1" parent="1">
      <mxGeometry x="560" y="630" width="140" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Edges/Arrows -->
    <mxCell id="e1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="step1" target="step2">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <mxCell id="e2" value="pass" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="step2" target="step3">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <mxCell id="e3" value="URL" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#70AD47;" edge="1" parent="1" source="step3" target="step4a">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <mxCell id="e4" value="Base64" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#70AD47;" edge="1" parent="1" source="step3" target="step4b">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <mxCell id="e5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="step4a" target="step5">
      <mxGeometry relative="1" as="geometry">
        <Array as="points">
          <mxPoint x="260" y="430"/>
          <mxPoint x="420" y="430"/>
        </Array>
      </mxGeometry>
    </mxCell>
    
    <mxCell id="e6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="step4b" target="step5">
      <mxGeometry relative="1" as="geometry">
        <Array as="points">
          <mxPoint x="580" y="430"/>
          <mxPoint x="420" y="430"/>
        </Array>
      </mxGeometry>
    </mxCell>
    
    <mxCell id="e7" value="valid" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="step6" target="step7">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <mxCell id="e8" value="CUDA" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#ED7D31;" edge="1" parent="1" source="step7" target="step8">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <mxCell id="e9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="step5" target="step6">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <mxCell id="e10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="step8" target="step9">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <mxCell id="e11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="step9" target="step10">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <mxCell id="e12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="step10" target="step11">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <mxCell id="e13" value="fail" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#C00000;dashed=1" edge="1" parent="1" source="step6" target="error">
      <mxGeometry relative="1" as="geometry">
        <Array as="points">
          <mxPoint x="520" y="565"/>
          <mxPoint x="520" y="655"/>
        </Array>
      </mxGeometry>
    </mxCell>
    
    <mxCell id="e14" value="error" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#C00000;dashed=1" edge="1" parent="1" source="step8" target="error">
      <mxGeometry relative="1" as="geometry">
        <Array as="points">
          <mxPoint x="320" y="735"/>
          <mxPoint x="320" y="655"/>
        </Array>
      </mxGeometry>
    </mxCell>
    
    <!-- Side Notes -->
    <mxCell id="note1" value="Input Formats:&#xa;• JPEG, PNG, WebP&#xa;• BMP, TIFF, GIF&#xa;• ICO, etc." style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#D6B656;fontSize=10;align=left" vertex="1" parent="1">
      <mxGeometry x="80" y="250" width="120" height="70" as="geometry"/>
    </mxCell>
    
    <mxCell id="note2" value="Output:&#xa;• Grayscale PNG&#xa;• Min/Max Depth&#xa;• Base64 Encoded" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E2EFDA;strokeColor=#70AD47;fontSize=10;align=left" vertex="1" parent="1">
      <mxGeometry x="560" y="930" width="140" height="70" as="geometry"/>
    </mxCell>
    
  </root>
</mxGraphModel>